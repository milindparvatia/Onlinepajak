# OnlinePajak

## steps to install this project

1.  clone this repo or download it
2.  pip install -r requirements.txt
3.  cd onlinepajak
4.  python manage.py migrate
5.  python manage.py runserver

## Application design

the application design is divided in two parts 

> 1.) database design
     
> 2.) API designs

### 1.) database design

to design the database from the parquet file I have normalized whole structure in below format.

#### User
User will be default Django User model which we can access directly from django.contrib.auth.models import User, and I have used username as main databse.user_id since django enforce unique primary key as username instead auto incremented column id. To bypass we can extend user model to specify User's column id field as string instead of integer.

column name | comments | 
--- | --- |
username | primary key, will be used as user_id | 


#### Company
The company model will have company_id as primary key, then all the company related fields like company_name, npwp, email, address, city, region, post_code. 

column name | comments | 
--- | --- |
id | primary key, will be used as company_id |
company_name | --- |
npwp | --- |
email | --- |
address | --- |
city | --- |
region | --- |
post_code | --- |

#### Vendor
The Vendor will be all the third party transaction companies performed are. in this table I have used vendor_id as primary key and added vendor_name to database

column name | comments | 
--- | --- |
id | primary key, will be used as vendor_id | 
vendor_name | primary key, will be used as vendor_name | 

#### Invoice
The Invoice will be main table where everything will be combined in one place. I have not specify invoce_id as primary key because I found out that there are few repeating values in data. I have created invoice model as below.

column name | comments | 
--- | --- |
id | primary key, autogenerated |
invoice_id | --- |
user | foreign key of User model |
company | foreign key of Company model |
vendor | foreign key of Vendor model |
transaction_type | --- |
commercial_invoice_number | --- |
status_start | --- |
status_tax_summary | --- |
invoice_date | --- |
due_date | --- |
item_name | --- |
unitprice | change to float |
quantity | change to float |
discount | change to float |
gross_amount | change to float |
tax_amount | change to float |
total_amount | change to float |
tax_period | --- |
revision | --- |
reported_date | --- |
reported_status | --- |
reported_status_desc | --- |
tax_type | --- |
tax_document_number | --- |
tax_document_date | --- |
approved_date | --- |

### 2.) API design

I have used django rest framework's APIView to perform API creation in both cases.

Notes:

1) I have used insensitive case for company's name so both small letter and capital letter will work in api.
2) If company_name is not specify api will return 400 status code, if company_name is not found in database API will return 404, if company's name found API will return 200 status code.
3) As mentioned in note I have not implemented authentication.

#### 1) verification of third-parties:

> url: http://127.0.0.1:8000/api/v1/

>arguments: third party company name as: vendor_name

>sample url: http://127.0.0.1:8000/api/v1?vendor_name=PD Hasanah

> output: {"status_code":200,"third_party_company_exist":true}

#### 2)  scoring of commercial relationship between companies:

> url: http://127.0.0.1:8000/api/v2/

>arguments: company_name= , vendor_name=

>sample url: http://127.0.0.1:8000/api/v2?company_name=Perum Pudjiastuti Rahmawati&format=json&vendor_name=CV Latupono

> output: {"status_code":200,"total_transactions":2}

#### 3.) OPTIONAL importing csv data to database

I have used django View function to create view with simple template where we can pass csv file which will convert csv data and store it in djnago models.

> url: http://127.0.0.1:8000/

>arguments: None

> upload csv file to dataset

> output: {"status_code": 200}
